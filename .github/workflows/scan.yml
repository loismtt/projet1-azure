name: Simple Trivy Scan - Image Externe

on:
  # Permet de lancer le workflow manuellement depuis l'interface GitHub
  workflow_dispatch:

jobs:
  scan_image:
    runs-on: ubuntu-latest
    
    steps:
    - name: ‚¨áÔ∏è Checkout code
      uses: actions/checkout@v4

    - name: üõ°Ô∏è Lancement du scan Trivy sur l'image Nginx et exportation
      uses: aquasec/trivy-action@master
      with:
        image-ref: 'ghcr.io/linuxserver/nginx:latest'
        scan-type: 'image'
        format: 'table'
        severity: 'CRITICAL,HIGH'
        exit-code: '1'
        # --- Ajout de l'exportation dans un fichier ---
        output: 'trivy-report-nginx.txt'
        # ---------------------------------------------

    - name: ‚¨ÜÔ∏è Upload du rapport Trivy en tant qu'artefact
      uses: actions/upload-artifact@v4
      with:
        name: trivy-security-report
        path: trivy-report-nginx.txt
        # Optionnel: d√©finir la dur√©e de r√©tention de l'artefact (en jours)
        # retention-days: 7
